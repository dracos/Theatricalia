{% extends 'base.html' %}
{% load prettify %}

{% block title %}{{ view.name|prettify }}&rsquo;{% ifnotequal view.name|last 's' %}s{% endifnotequal %} profile{% endblock %}

{% block content %}

<h1>{{ view.name|prettify }}&rsquo;{% ifnotequal view.name|last 's' %}s{% endifnotequal %} profile</h1>

{% include 'includes/messages.html' %}

<div id="primary">

{% if profile.biography %}
{{ profile.biography|prettify|linebreaks }}
{% else %}
<p>This user has not yet supplied any details.</p>
{% endif %}

<h2>Seen, or going to see</h2>

<ul>
{% for s in seen %}
<li><a href="{{ s.production.get_absolute_url }}">{{ s.production }}</a>
{% endfor %}
</ul>

</div>

<div class="secondary">

<ul>
    {% if not view.is_active %} <li>Inactive. {% endif %}
    {% if view.is_superuser %}
        {% ifequal view.username 'matthew' %}
            <li><em>Principal.</em>
        {% else %}
            <li>Administrator.
        {% endifequal %}
    {% else %}{% if view.is_staff %} <li>Staff. {% endif %}{% endif %}
    {% if profile.url %}
    <li><a href="{{ profile.url }}">Website</a>
    {% endif %}
    <li>Joined {{ view.date_joined|date:"jS F Y" }}.
    <li>Last logged in on {{ view.last_login|date:"jS F Y" }}.
{% ifequal user view %}
    <li><a href="{{ profile.get_edit_url }}">Edit your profile and alerts</a>
{% endifequal %}
    </ul>

<h2>Last ten changes</h2>

<ul>
{% for l in latest %}
<li>
{% for v in l %}
{% if not forloop.first %}<br>{% endif %}
<a href="{{ v.1 }}">{{ v.0 }}</a>
{% endfor %}
{% empty %}
<li>This user has made no changes or additions yet.
{% endfor %}
</ul>

{% ifequal user view %}
<h2 class="no-descenders">Your alerts</h2>
{% if user.alerts or user.local_alerts %}
<ul>
{% for alert in user.alerts.all %}
<li>{{ alert }} &ndash; <a href="{{ profile.get_alert_remove_url }}/{{ alert.id }}">remove</a>
{% endfor %}
{% for alert in user.local_alerts.all %}
<li>{{ alert }} &ndash; <a href="{{ profile.get_alert_remove_url }}/{{ alert.id }}">remove</a>
{% endfor %}
</ul>
{% else %}
<p>You currently have no alerts. Visit a person, play, or place
page to set one up.
{% endif %}
{% else %}
{% if not user.is_authenticated %}
<p><a href="{% url login %}?next={{ request.path }}">Sign in</a> to manage your alerts, say which productions you have seen, and more.</p>
{% endif %}
{% endifequal %}

</div>

{% endblock %}
